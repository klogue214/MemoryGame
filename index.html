<html>
<head>
	<meta charset="UTF-8">
	<title>Memory Game</title>
	<script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
	<style>
	@font-face {
		font-family: gobold;
		src: url(gobold.ttf);
	}
	* {
		box-sizing: border-box;
		letter-spacing: 1px;
		font-family: gobold;
	}
	body {
		background: url('table.jpg');
		background-size: cover;
	}
	h1 {
		font-size: 48px;
		margin: 15px 0;
		color: #fff;
	}
	.container {
		width: 1080px;
		margin: 25px auto;
	}
	.menu, .results {
		height: 275px;
		width: 350px;
		margin-top: -100px;
		margin-left: -175px;
		position: absolute;
		padding: 10px;
		left: 50%;
		top: 45%;
		text-align: center;
		color: #ffeaa0;
		border: 5px solid #ffeaa0;
		border-radius: 20px;
		box-shadow: 0 0 25px 5px #000;
		background: #000;
		vertical-align: text-bottom;

	}
	.results {
		display: none;
		height: 335px;
		margin-top: -125px;
	}
	.results h2 {
		border-bottom: 2px solid #ffeaa0;
		padding-bottom: 4px;
	}
	ul {
		list-style-type: none;
		padding: 0;
		margin: 0;
	}
	input, label {
		margin: 10px;
		width: 75%;
	}
	input[type=submit] {
		font-size: 16px;
		width: 50%;
		border: 3px solid #ffeaa0;
		border-radius: 10px;
		padding: 10px;
		background: #000;
		color: #ffeaa0;
		outline: 0;
	}
	input[type=submit]:hover {
		cursor: pointer;
		box-shadow: 0 0 15px #fff;
	}
	input[type=text] {
		padding: 5px;
		font-size: 18px;
		border-radius: 10px;
		outline: 0;
		text-align: center;
	}
	.card {
		height: 200px;
		width: 150px;
		float: left;
		margin: 15px;
		border: 5px solid #000;
		border-radius: 5px;
		box-shadow: 5px 5px 10px #261600;
		background-image: url('card_back.jpg');
		background-size: cover;
	}
	.card:hover {
		cursor: pointer;
		border: 5px solid #ffeaa0;
		box-shadow: 0 0 20px 3px #ffeaa0;
	}
	.card.selected {
		border: 5px solid #ffeaa0;
		box-shadow: 0 0 20px 3px #ffeaa0;
		transform: rotateY(180deg);
		transition: 0.5s;
	}
	.shake {
		animation-name: shake;
		animation-duration: .5s;
	}
	@keyframes shake {
		0%, 100% {transform: translateX(0);}
		20%, 60% {transform: translateX(-30px);}
		40%, 80% {transform: translateX(30px);}
	}
	</style>
</head>
<body>
	<div class="container">
		<div class="timer"></div>
	</div>
	<div class="menu">
		<h1>Pick A Match</h1>
		<form>
			<label for="name">Enter your name:</label>
			<input class="player-name" name="name" type="text">
			<input class="start-game" type="submit" value="Start Game">
		</form>
	</div>
	<div class="results">
		<h1>You did it!</h1>
		<p class="time"></p>
		<h2>Fastest Times</h2>
		<ul class="highscores">
			
		</ul>
	</div>
<script>
$(document).ready(function(){
	var app = {
		cardValues: [1,2,3,4,5,6,7,8,9,1,2,3,4,5,6,7,8,9],
		imageType: 'animals',
		player: 'anonymous',
		startTime: 0,
		init: function() {
			app.shuffle();
			app.preloadImages();
			$('.start-game').on('click', function(e) {
				app.gatherData(e);
			});
		},
		gatherData: function(e) {
			e.preventDefault();
			if($('.player-name').val() !== '') {
				app.player = $('.player-name').val();
				app.clickHandlers();
				app.startTime = new Date();
				console.log(app.startTime);
			} else {
				$('input[type=text]').addClass('shake');
				setTimeout(function() { $('input[type=text]').removeClass('shake'); }, 500);
				return false;
			}
			$('.menu').fadeOut();
		},
		clickHandlers: function() {
			$('.card').on('click', function() {
				app.flipCard($(this));
			});
		},
		shuffle: function() {
			var swap = 0;
			var temp = 0;
			for(i = 0; i < app.cardValues.length; i ++) {
				swap = Math.round(Math.random()*i);
				temp = app.cardValues[i];
				app.cardValues[i] = app.cardValues[swap];
				app.cardValues[swap] = temp;
				$('.container').append('<div class="card unmatched"></div>');
			}
			$('.card').each(function(index){
				$(this).attr('data-card', app.cardValues[index]);
			});
		},
		flipCard: function(card) {
			card.addClass('selected');
			card.css({'background-image': 'url("http://lorempixel.com/150/200/'+app.imageType+'/'+card.data('card')+'")'});
			if($('.selected').length == 2) {
				app.checkMatch();
			}
		},
		checkMatch: function() {
			if($('.selected').first().data('card') == $('.selected').last().data('card')) {
				setTimeout(function() {
					$('.selected').each(function() {
						$(this).removeClass('unmatched selected').css({'background':''}).animate({ opacity: 0 },{duration: 1000});
						app.checkWin();
					});
				}, 1000);
			} else {
				setTimeout(function(){
					$('.selected').each(function() {
						$(this).removeClass('selected').css({'background':''});
					});
				}, 1000);
			}
		},
		checkWin: function() {
			if($('.unmatched').length === 0) {
				$('.results').show();
				var endTime = new Date();
				var time = Math.round((endTime - app.startTime)/1000);
				$('.results .time').text('Your time was '+time+' seconds');
				app.highScores(time);
			}
		},
		highScores: function(time) {
			$.ajax({
				url:'highscores/view.php',
				method: 'POST',
				data: {'name': app.player, 'time': time},
				dataType: 'JSON',
				success: function(data) {
					$.each(data, function(key, value) {
						$('.results .highscores').append('<li>'+key+' -- '+value+' seconds');
					});
				}
			});
		},
		preloadImages: function() {
			var img = [];
			for(i = 0; i < app.cardValues.length; i ++) {
				img[i] = new Image();
				img[i].src = "http://lorempixel.com/150/200/"+app.imageType+"/"+i;
			}	
		}
	};
	app.init();
});
</script>
</body>
</html>